<!DOCTYPE html>
<html manifest="cache.appcache">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1" />
    <title>[Concurrency is not Parallelism (it&#39;s better)]</title>
    <link href="http://fonts.googleapis.com/css?family=Droid+Sans|Droid+Sans+Mono" rel="stylesheet" type="text/css" />
    <link id="prettify-link" href="src/prettify/prettify.css" rel="stylesheet" disabled />
    <link href="css/default.css" class="theme" rel="stylesheet" media="screen"  />
    <link href="css/common.css" rel="stylesheet" media="screen" />
  </head>
  <body>
    <nav id="helpers">
      <button title="Previous slide" id="nav-prev" class="nav-prev">⇽</button> 
      <button title="Jump to a random slide" id="slide-no">5</button> 
      <button title="Next slide" id="nav-next" class="nav-next">⇾</button>
      <menu>
        <button type="checkbox" data-command="toc" title="Table of Contents" class="toc">TOC</button>
        <button type="checkbox" data-command="notes" title="View Slide Notes">✏</button>
        <button type="checkbox" data-command="source" title="View slide source">↻</button>
        <button type="checkbox" data-command="help" title="View Help">?</button>
      </menu>
    </nav>
    <div class="presentation">
      <div id="presentation-counter">Loading...</div>
      <div class="slides">
        <div class="slide" id="landing-slide">
          <style>
            #landing-slide p {
              font-size: 35px;
            }
          </style>
          <section class="middle">
            <p>This presentation is an HTML5 web site</p>
            <p>Press <span id="left-init-key" class="key">&rarr;</span> key to advance.</p>
          </section>

          <aside class="note">
            <section>
              Welcome! (This field is for presenter notes and commentary.)
            </section>
          </aside> 
        </div>

        <div class="slide" id="controls-slide">
          <header>Controls</header>
          <style>
            #controls-slide li, #controls-slide p {
              font-size: 32px;
            }
            #controls-slide .key {
              bottom: 2px;
            }
          </style>
          <section>
            <ul>
              <li><span class="key">&larr;</span> and <span class="key">&rarr;</span> to move around.</li>
              <li><span class="key">Ctrl/Command</span> and <span class="key">+</span> or <span class="key">-</span> to zoom.</li>
              <li><span class="key">S</span> to view page source.</li>
              <li><span class="key">N</span> to toggle speaker notes.</li>
              <li><span class="key">3</span> to toggle 3D effect.</li>
              <li><span class="key">0</span> to toggle help.</li>
            </ul>
          </section>
        </div>

        <div class="slide" id="hello">
          <section class="middle">
            <hgroup><img src="http://golang.org/doc/gopher/bumper640x360.png"></hgroup>
          </section>
        </div>

        <div class="slide" id="title-slide">
          <style>
            #title-slide h1, #title-slide h2 {
              color: black;
            }
            #title-slide h1 {
              font-size: 80px;
            }
            #title-slide h2 {
              font-size: 36px;
            }
          </style>
          <section class="middle">
            <hgroup>
              <h1>
                
                  Concurrency<br>
                
                  is not<br>
                
                  Parallelism<br>
                
                  (it&#39;s better)<br>
                
              </h1>
              <h2>
                Rob Pike<br>r@golang.org<br>Waza<br>Jan 11, 2012<br>
              </h2>
            </hgroup>
          </section>
        </div>

	<!-- start of slide 0 -->
        <div class="slide" id="slide-0">
          <header>Go supports concurrency</header>

          <section>
            <p>
            Go provides:<br>
            </p>
            
            <ul>
            
            <li>concurrent execution (goroutines)</li>
            
            <li>synchronization and messaging (channels)</li>
            
            <li>multi-way concurrent control (select)</li>
            
            </ul>
            



          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 0 --><!-- start of slide 1 -->
        <div class="slide" id="slide-1">
          <header>Goroutines</header>

          <section>
            <p>
            A goroutine is a function running independently  in the same address space.<br>
            
            <br>
            </p>
            


<pre>
<!--{{code "concur/snippets" `/starts.running/` `/return/`}}
-->go f(&#34;hello&#34;, &#34;world&#34;) // f starts running
g() // does not wait for f to return
</pre>


          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 1 --><!-- start of slide 2 -->
        <div class="slide" id="slide-2">
          <header>Channels</header>

          <section>
            <p>
            Channels are typed values that allow goroutines to synchronize and exchange information.<br>
            
            <br>
            </p>
            


<pre>
<!--{{code "concur/snippets" `/make.*chan/` `/completedAt/`}}
-->timerChan := make(chan time.Time)
go func() {
    time.Sleep(deltaT)
    timerChan &lt;- time.Now() // send time on timerChan
}()
// Do something else; when ready:
completedAt := &lt;-timerChan // receive completion time
</pre>


          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 2 --><!-- start of slide 3 -->
        <div class="slide" id="slide-3">
          <header>Select</header>

          <section>
            <p>
            The select statement is like a switch, but the decision is based on ability to communicate rather than just equal values.<br>
            
            <br>
            </p>
            


<pre>
<!--{{code "concur/snippets" `/select/` `/}/`}}
-->select {
case v := &lt;-ch1:
    fmt.Println(&#34;channel 1 sends&#34;, v)
case v := &lt;-ch2:
    fmt.Println(&#34;channel 2 sends&#34;, v)
default: // optional
    fmt.Println(&#34;neither channel was ready&#34;)
}
</pre>


          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 3 --><!-- start of slide 4 -->
        <div class="slide" id="slide-4">
          <header>Go really supports concurrency</header>

          <section>
            <p>
            It&#39;s routine to have thousands of goroutines active in a program.<br>
            
            <br>
            
            Stacks start small, but grow and shrink as required.<br>
            
            <br>
            
            Goroutines aren&#39;t free, but they&#39;re very cheap.<br>
            
            <br>
            </p>
            



          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 4 --><!-- start of slide 5 -->
        <div class="slide" id="slide-5">
          <header>Goroutines are not threads </header>

          <section>
            <p>
            They&#39;re much cheaper.<br>
            
            <br>
            
            Goroutines are multiplexed onto threads as required.<br>
            
            <br>
            
            When a goroutine blocks, that thread blocks but other goroutines do not.<br>
            
            <br>
            </p>
            



          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 5 --><!-- start of slide 6 -->
        <div class="slide" id="slide-6">
          <header>Concurrency is cool! Yay parallelism!!</header>

          <section>
            <p>
            NO! A fallacy.<br>
            
            <br>
            
            When Go was announced, many were confused by the distinction.<br>
            
            <br>
            
            &#34;I ran the prime sieve with 4 processors and it got slower!&#34;<br>
            
            <br>
            </p>
            



          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 6 --><!-- start of slide 7 -->
        <div class="slide" id="slide-7">
          <header>Concurrency is not parallelism</header>

          <section>
            <p>
            Concurrency is a way to structure a program by breaking it into pieces that can be executed independently.<br>
            
            <br>
            
            Hoare: Communicating Sequential Processes (CSP).<br>
            
            <br>
            
            Concurrency can enable parallelism, but it does not require it.<br>
            
            <br>
            </p>
            



          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 7 --><!-- start of slide 8 -->
        <div class="slide" id="slide-8">
          <header>Events vs. threads</header>

          <section>
            <p></p>
            



          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 8 --><!-- start of slide 9 -->
        <div class="slide" id="slide-9">
          <header>Gophers gophers gophers</header>

          <section>
            <p></p>
            



          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 9 --><!-- start of slide 10 -->
        <div class="slide" id="slide-10">
          <header>Closures are part of the story</header>

          <section>
            <p>
            Closures are just local functions.<br>
            </p>
            


<pre>
<!--{{code "concur/snippets" `/Compose/` `/sin,/`}}
-->func Compose(f, g func(x float) float)
                  func(x float) float {
     return func(x float) float {
        return f(g(x))
    }
}

print(Compose(sin, cos)(0.5))
</pre>


          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 10 --><!-- start of slide 11 -->
        <div class="slide" id="slide-11">
          <header>Launching daemons</header>

          <section>
            <p>
            Use a closure to wrap a background operation.<br>
            
            <br>
            
            The for range operation runs until channel is drained.<br>
            </p>
            


<pre>
<!--{{code "concur/snippets" `/copy.input/` `/^}/`}}
-->go func() { // copy input to output
    for val := range input {
        output &lt;- val
    }
}
</pre>


          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 11 --><!-- start of slide 12 -->
        <div class="slide" id="slide-12">
          <header>A simple load balancer (1)</header>

          <section>
            <p>
            A unit of work:<br>
            
            <br>
            </p>
            


<pre>
<!--{{code "concur/load1" `/type/` `/^}/`}}
-->type Work struct {
    x, y, z int
}
</pre>


          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 12 --><!-- start of slide 13 -->
        <div class="slide" id="slide-13">
          <header>A simple load balancer (2)</header>

          <section>
            <p>
            A worker task:<br>
            
            <br>
            </p>
            


<pre>
<!--{{code "concur/load1" `/worker/` `/^}/`}}
-->func worker(in &lt;-chan *Work, out chan &lt;- *Work) {
   for w := range in {
      w.z = w.x * w.y
      out &lt;- w
   }
}
</pre>


          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 13 --><!-- start of slide 14 -->
        <div class="slide" id="slide-14">
          <header>A simple load balancer (3)</header>

          <section>
            <p>
            The runner:<br>
            
            <br>
            </p>
            


<pre>
<!--{{code "concur/load1" `/Run/` `/^}/`}}
-->func Run() {
   in, out := make(chan *Work), make(chan *Work)
   for i := 0; i &lt; 10; i++ {
       go worker(in, out)
   }
   go sendLotsOfWork(in)
   receiveLotsOfResults(out)
}
</pre>


          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 14 --><!-- start of slide 15 -->
        <div class="slide" id="slide-15">
          <header>Concurrency enables parallelism</header>

          <section>
            <p>
            The load balancer is implicitly parallel and scalable.<br>
            
            <br>
            </p>
            



          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 15 --><!-- start of slide 16 -->
        <div class="slide" id="slide-16">
          <header>Concurrency simplifies synchronization</header>

          <section>
            <p>
            No explicit synchronization needed.<br>
            
            <br>
            
            The structure of the program is implicitly synchronized.<br>
            
            <br>
            
            <br>
            
            <br>
            </p>
            



          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 16 --><!-- start of slide 17 -->
        <div class="slide" id="slide-17">
          <header>Database multi-way request</header>

          <section>
            <p>
            Query servers in replicated database, return first response.<br>
            </p>
            


<pre>
<!--{{code "concur/snippets" `/Query/` `/^}/`}}
-->func Query(conns []Conn, query string) Result {
    ch := make(chan Result, 1)  // buffer of 1 item
    for _, conn := range conns {
      go func(c Conn) {
        select {
          case ch &lt;- c.DoQuery(query):
            // nothing to do
          default: // executes if ch is blocked
            // nothing to do
        }
      }(conn)
    }
    return &lt;-ch
}
</pre>


          </section>
        </div> <!-- end slide template -->
      <!-- end of slide 17 -->

        <div class="slide" id="goodbye">
          <section class="middle">
            <hgroup><img src="http://golang.org/doc/gopher/bumper640x360.png"></hgroup>
          </section>
        </div>

      </div>

      <div id="speaker-note" class="invisible" style="display: none;">
      </div> <!-- speaker note -->
      <aside id="help" class="sidebar invisible" style="display: hidden;">
        <table>
          <caption>Help</caption>
          <tbody>
            <tr>
              <th>Move Around</th>
              <td>&larr;&nbsp;&rarr;</td>
            </tr>
            <tr>
              <th>Source File</th>
              <td>s</td>
            </tr>
            <tr>
              <th>Speaker Notes</th>
              <td>n</td>
            </tr>
            <tr>
              <th>Toggle 3D</th>
              <td>3</td>
            </tr>
            <tr>
              <th>Help</th>
              <td>0</td>
            </tr>
          </tbody>
        </table>
      </aside>

    </div> <!-- presentation -->

    <!--[if lt IE 9]>
    <script 
      src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js">
    </script>
    <script>CFInstall.check({ mode: "overlay" });</script>
    <![endif]-->

    <script src="js/utils.js"></script>
  </body>
</html>
